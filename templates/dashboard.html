<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/static/css/landing.css" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <header class="expanded">
        <nav class="header__navegation">
          <img
            src="https://static.wixstatic.com/media/85b92c_f21a10fac4d9497397a19f8aade0ec99~mv2.png/v1/fill/w_346,h_95,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/PCE_White%20registered1.png"
            alt="logo" srcset="" />
          <ul id="navbarUl">
            <li><a href="/home">Home</a></li>
            <li><a href="/model">Upload Model</a></li>
            <li><a href="/">Sign Out</a></li>
          </ul>
        </nav>
      </header>
    <div class="dashboard">
      <!-- <p>selected File: </p> -->
        <div class="column">
          <div class="decision-table">
            <h2>Decision Summary</h2>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Human</th>
                        <th>AI</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Included </td>
                        <td><span id="totalIncludedHuman">-</span></td>
                        <td><span id="totalIncludedAI">-</span></td>
                    </tr>
                    <tr>
                        <td>Excluded </td>
                        <td><span id="totalExcludedHuman">-</span></td>
                        <td><span id="totalExcludedAI">-</span></td>
                    </tr>
                    <tr>
                      <td colspan="3" style="text-align: center;color: white; background-color: #0063a0; font-weight: bold;">Conflicting Decisions : <span id="conflictingdecisions">-</span></td>
                  </tr>
                    <tr>
                        <td colspan="3" style="text-align: center;color: white; background-color:#0063a0; font-weight: bold;">Accuracy is <span id="accuracyPercentage">-</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
          
        <div class="metric-table">
          <h3 id="metricTableHeading">More Info</h3>
          <p id="moreInfo" style="font-size: 12px;">Additional information about Model.</p>
          <table id="metricTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Accuracy</td>
                        <td><span id="accuracyValue">-</span></td>
                    </tr>
                    <tr>
                        <td>Precision</td>
                        <td><span id="precisionValue">-</span></td>
                    </tr>
                    <tr>
                        <td>Recall</td>
                        <td><span id="recallValue">-</span></td>
                    </tr>
                    <tr>
                        <td>F1-Score</td>
                        <td><span id="f1-scoreValue">-</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="exclusion-table">
          <h2>Exclusion Reason</h2>
          <table>
              <thead>
                  <tr>
                      <th>Exclusion reason</th>
                      <th>Count</th>
                      
                  </tr>
              </thead>
              <tbody id="exclusionReasonTableBody">
                
                  
              </tbody>
              <tr>
                <td style="font-weight: bold;color: white; background-color:#0063a0;">Grand Total</td>
                <td style="font-weight: bold;color: white; background-color:#0063a0;" id="grandTotal">-</td>
            </tr>
          </table>
      </div>







        </div>
        
        <div class="column">
            
        
           











          <h2>Visual Stats</h2>
          <div id="aiDecisionChart"></div>
          <div id="yearCheckboxes"></div>
            <div id="plotlyGraphContainer"></div>
            <div id="typeCheckboxes"></div>
            <div id="plotPublicationType"></div>
        </div>
    </div>

    <script defer src="/static/js/script.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    // Fetch and populate options for Publication Year and Publication Type
    fetch('/get_unique_values')
        .then(response => response.json())
        .then(data => {
            const publicationYearSelect = document.getElementById("publicationYear");
            const publicationTypeSelect = document.getElementById("publicationType");

            // Populate options dynamically
            data.publicationYear.forEach(year => {
                const option = document.createElement("option");
                option.value = year.toString();
                option.textContent = year.toString();
                publicationYearSelect.appendChild(option);
            });

            data.publicationType.forEach(type => {
                const option = document.createElement("option");
                option.value = type;
                option.textContent = type;
                publicationTypeSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error("Fetch Error:", error);
        });

    // Implement JavaScript to handle filter application
    function applyFilters() {
        const selectedYears = Array.from(document.getElementById("publicationYear").selectedOptions).map(option => option.value);
        const selectedTypes = Array.from(document.getElementById("publicationType").selectedOptions).map(option => option.value);

        // Make a GET request to your FastAPI endpoint
        fetch(`/filtered_data?publication_year=${encodeURIComponent(selectedYears.join(","))}&publication_type=${encodeURIComponent(selectedTypes.join(","))}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                // Log the response data for troubleshooting
                console.log(data);

                // Display the filtered data in the 'filteredData' div
                document.getElementById("filteredData").innerHTML = data;
            })
            .catch(error => {
                console.error("Fetch Error:", error);
            });
    }
</script>

    
</body>
</html>